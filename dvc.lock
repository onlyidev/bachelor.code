schema: '2.0'
stages:
  train:
    cmd: python main.py 10 32 1 data/train/ben.npy data/train/mal.npy
    deps:
    - path: data/train/ben.npy
      hash: md5
      md5: 07dca973a84263d062907e19dc8031b7
      size: 1434489392
    - path: data/train/mal.npy
      hash: md5
      md5: 3b53f4382adf6b9b3122c284df107703
      size: 1434489392
    params:
      params.yaml:
        train.Z: 10
        train.batch_size: 32
        train.benign: data/train/ben.npy
        train.malware: data/train/mal.npy
        train.num_epochs: 1
    outs:
    - path: dynamic.yaml
      hash: md5
      md5: 25cad90a2614a1e8ba9f069332625cad
      size: 47
  MCA:
    cmd: python mca.py
    deps:
    - path: data/train/ben.npy
      hash: md5
      md5: 07dca973a84263d062907e19dc8031b7
      size: 1434489392
    - path: data/train/mal.npy
      hash: md5
      md5: 3b53f4382adf6b9b3122c284df107703
      size: 1434489392
    - path: dynamic.yaml
      hash: md5
      md5: 25cad90a2614a1e8ba9f069332625cad
      size: 47
    params:
      params.yaml:
        train.mca: data/MCA.csv
      dynamic.yaml:
        malgan.id: 984c6217d8cb4da6bd79ff089cca7355
    outs:
    - path: data/MCA.csv
      hash: md5
      md5: 7f675faffb4ed0bd8d61e61792fb8d29
      size: 76627
  split:
    cmd: python scripts/split.py
    deps:
    - path: data/raw/sleipnir/benign
      hash: md5
      md5: a94ca5d3a46622b553d9d35ef8f18f0a.dir
      size: 4037404256
      nfiles: 19696
    - path: data/raw/sleipnir/malicious
      hash: md5
      md5: c7057fcf38ebd7dc19f47bd8aef0a360.dir
      size: 7173280084
      nfiles: 34994
    params:
      params.yaml:
        split.benign_dir: data/raw/sleipnir/benign
        split.malware_dir: data/raw/sleipnir/malicious
        split.random_state: 42
        split.test_size: 0.2
        split.unique_ratio: 0.7
        train.head: 1500
        train.num_features: 200
    outs:
    - path: data/train/ben.npy
      hash: md5
      md5: ce4074b812b401fcff394adfb2688d9a
      size: 960128
    - path: data/train/mal.npy
      hash: md5
      md5: df2152dd414ad50c7634ec2d9938fe27
      size: 960128
    - path: data/valid/ben.npy
      hash: md5
      md5: f3eef3bb44f77921fa1ccf51d995b3c9
      size: 240128
    - path: data/valid/mal.npy
      hash: md5
      md5: e06ef45af5d48029c41019dee9b96437
      size: 240128
  train_malgan:
    cmd: python main.py 100 32 500 data/train/ben.npy --gen-hidden-sizes 256 512 256
      --activation leakyrelu data/train/mal.npy
    deps:
    - path: data/train/ben.npy
      hash: md5
      md5: ce4074b812b401fcff394adfb2688d9a
      size: 960128
    - path: data/train/mal.npy
      hash: md5
      md5: df2152dd414ad50c7634ec2d9938fe27
      size: 960128
    params:
      params.yaml:
        train.Z: 100
        train.activation: leakyrelu
        train.batch_size: 32
        train.benign: data/train/ben.npy
        train.estimators: 10
        train.gen_hidden: 256 512 256
        train.malware: data/train/mal.npy
        train.name: Bachelor_1500_200-Features_lime_1_DLR-e6_Hidden_512_Z100
        train.num_epochs: 500
      dynamic.yaml:
        detector.id: 9d792ffe830d4659aef41e75cca266d8
  train_mca:
    cmd: python mca.py
    deps:
    - path: data/train/ben.npy
      hash: md5
      md5: ce4074b812b401fcff394adfb2688d9a
      size: 960128
    - path: data/train/mal.npy
      hash: md5
      md5: df2152dd414ad50c7634ec2d9938fe27
      size: 960128
    params:
      params.yaml:
        train.estimators: 10
        train.head: 1500
        train.mca: data/MCA.csv
        train.mca_components: 10
    outs:
    - path: data/MCA.csv
      hash: md5
      md5: 1145393a4598d64e70ff3e52a47e1d7b
      size: 497086
  train_mca_classifier:
    cmd: python mca_classifier.py
    deps:
    - path: data/MCA.csv
      hash: md5
      md5: 1145393a4598d64e70ff3e52a47e1d7b
      size: 497086
    params:
      params.yaml:
        train.estimators: 10
        train.mca: data/MCA.csv
  graph_mca:
    cmd: python scripts/graph_mca.py
    deps:
    - path: data/MCA.csv
      hash: md5
      md5: 1145393a4598d64e70ff3e52a47e1d7b
      size: 497086
    outs:
    - path: outs/mca_scatter.html
      hash: md5
      md5: 9bf2fd66d584b7e7d9b9c747fe09fd04
      size: 664270
  extract_normal_features:
    cmd: python lime_normal.py
    deps:
    - path: data/MCA.csv
      hash: md5
      md5: 1145393a4598d64e70ff3e52a47e1d7b
      size: 497086
    - path: data/train/ben.npy
      hash: md5
      md5: ce4074b812b401fcff394adfb2688d9a
      size: 960128
    - path: dynamic.yaml
      hash: md5
      md5: f91b540552a5ec84b4654c201355e855
      size: 195
    params:
      params.yaml:
        train.benign: data/train/ben.npy
        train.mca: data/MCA.csv
        train.normal_features: data/normal_features.txt
      dynamic.yaml:
        mca.id: 2a43695ab07c410b9a77796b42bac78e
        mca_classifier.id: 822e5989fe6747ebbdcdc017dd56bcb2
    outs:
    - path: data/normal_features.txt
      hash: md5
      md5: 3c8d89ade6e4e90c3b9295d11d07eea8
      size: 326
  experiment_base:
    cmd: PYTHONHASHSEED=0 python experiment.py normal
    deps:
    - path: data/valid/ben.npy
      hash: md5
      md5: f3eef3bb44f77921fa1ccf51d995b3c9
      size: 240128
    - path: data/valid/mal.npy
      hash: md5
      md5: e06ef45af5d48029c41019dee9b96437
      size: 240128
    - path: dynamic.yaml
      hash: md5
      md5: f91b540552a5ec84b4654c201355e855
      size: 195
    params:
      params.yaml:
        metrics.normal: metrics/normal.json
        valid.benign: data/valid/ben.npy
        valid.malware: data/valid/mal.npy
      dynamic.yaml:
        detector.id: 9d792ffe830d4659aef41e75cca266d8
        malgan.id: 42a220ecc53042a19c749339ce83e1c6
    outs:
    - path: metrics/normal.json
      hash: md5
      md5: 12975428be4a76d313396a4cfa59d26b
      size: 901
    - path: metrics/normal.png
      hash: md5
      md5: 620c92aa04703c2cc966182e99e49bde
      size: 19151
  experiment_lime:
    cmd: PYTHONHASHSEED=0 python experiment.py lime
    deps:
    - path: data/MCA.csv
      hash: md5
      md5: 1145393a4598d64e70ff3e52a47e1d7b
      size: 497086
    - path: data/normal_features.txt
      hash: md5
      md5: 3c8d89ade6e4e90c3b9295d11d07eea8
      size: 326
    - path: data/valid/ben.npy
      hash: md5
      md5: f3eef3bb44f77921fa1ccf51d995b3c9
      size: 240128
    - path: data/valid/mal.npy
      hash: md5
      md5: e06ef45af5d48029c41019dee9b96437
      size: 240128
    - path: dynamic.yaml
      hash: md5
      md5: f91b540552a5ec84b4654c201355e855
      size: 195
    params:
      params.yaml:
        train.mca: data/MCA.csv
        train.normal_features: data/normal_features.txt
        valid.benign: data/valid/ben.npy
        valid.malware: data/valid/mal.npy
      dynamic.yaml:
        detector.id: 9d792ffe830d4659aef41e75cca266d8
        malgan.id: 42a220ecc53042a19c749339ce83e1c6
        mca.id: 2a43695ab07c410b9a77796b42bac78e
        mca_classifier.id: 822e5989fe6747ebbdcdc017dd56bcb2
    outs:
    - path: metrics/lime.json
      hash: md5
      md5: d277850b282fc4def25ee066704cbfa6
      size: 822
    - path: metrics/lime.png
      hash: md5
      md5: ad712a65f8b76dd02320140e46532228
      size: 18720
    - path: metrics/lime_obf.json
      hash: md5
      md5: d277850b282fc4def25ee066704cbfa6
      size: 822
    - path: metrics/lime_obf.png
      hash: md5
      md5: 71708135a5cf7f0e85a9111801156ebe
      size: 25227
  train_detector:
    cmd: python train_detector.py
    deps:
    - path: data/train/ben.npy
      hash: md5
      md5: ce4074b812b401fcff394adfb2688d9a
      size: 960128
    - path: data/train/mal.npy
      hash: md5
      md5: df2152dd414ad50c7634ec2d9938fe27
      size: 960128
    params:
      params.yaml:
        split.random_state: 42
        train.benign: data/train/ben.npy
        train.estimators: 10
        train.malware: data/train/mal.npy
  extract_normal_categorical_features:
    cmd: python lime_normal_categorical.py
    deps:
    - path: data/train/ben.npy
      hash: md5
      md5: ce4074b812b401fcff394adfb2688d9a
      size: 960128
    - path: dynamic.yaml
      hash: md5
      md5: f91b540552a5ec84b4654c201355e855
      size: 195
    params:
      params.yaml:
        train.benign: data/train/ben.npy
        train.normal_categorical_features: data/normal_categorical_features.txt
      dynamic.yaml:
        detector.id: 9d792ffe830d4659aef41e75cca266d8
    outs:
    - path: data/normal_categorical_features.txt
      hash: md5
      md5: bbae9eaae000a3da64646a49c920fa95
      size: 142
  experiment_lime_categorical:
    cmd: PYTHONHASHSEED=0 python experiment.py categorical
    deps:
    - path: data/normal_categorical_features.txt
      hash: md5
      md5: bbae9eaae000a3da64646a49c920fa95
      size: 142
    - path: data/valid/ben.npy
      hash: md5
      md5: f3eef3bb44f77921fa1ccf51d995b3c9
      size: 240128
    - path: data/valid/mal.npy
      hash: md5
      md5: e06ef45af5d48029c41019dee9b96437
      size: 240128
    - path: dynamic.yaml
      hash: md5
      md5: f91b540552a5ec84b4654c201355e855
      size: 195
    params:
      params.yaml:
        train.normal_categorical_features: data/normal_categorical_features.txt
        valid.benign: data/valid/ben.npy
        valid.malware: data/valid/mal.npy
      dynamic.yaml:
        detector.id: 9d792ffe830d4659aef41e75cca266d8
        malgan.id: 42a220ecc53042a19c749339ce83e1c6
    outs:
    - path: metrics/lime_cat.json
      hash: md5
      md5: e2b1d020ce7e967a6adb35c4dedb0e02
      size: 947
    - path: metrics/lime_cat.png
      hash: md5
      md5: bdf65727961cec60cbed11ab281db029
      size: 19229
    - path: metrics/lime_cat_obf.json
      hash: md5
      md5: e2b1d020ce7e967a6adb35c4dedb0e02
      size: 947
    - path: metrics/lime_cat_obf.png
      hash: md5
      md5: acd80e040dce5e7117c1b0146b41a240
      size: 24722
  notify:
    cmd: python scripts/notify.py "Pipeline Bachelor_1500_200-Features_lime_1_DLR-e6_Hidden_512_Z100
      has been executed. More at https://flow.mlops"
    params:
      params.yaml:
        train.name: Bachelor_1500_200-Features_lime_1_DLR-e6_Hidden_512_Z100
