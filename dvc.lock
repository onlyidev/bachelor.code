schema: '2.0'
stages:
  train:
    cmd: python main.py 10 32 1 data/train/ben.npy data/train/mal.npy
    deps:
    - path: data/train/ben.npy
      hash: md5
      md5: 07dca973a84263d062907e19dc8031b7
      size: 1434489392
    - path: data/train/mal.npy
      hash: md5
      md5: 3b53f4382adf6b9b3122c284df107703
      size: 1434489392
    params:
      params.yaml:
        train.Z: 10
        train.batch_size: 32
        train.benign: data/train/ben.npy
        train.malware: data/train/mal.npy
        train.num_epochs: 1
    outs:
    - path: dynamic.yaml
      hash: md5
      md5: 25cad90a2614a1e8ba9f069332625cad
      size: 47
  MCA:
    cmd: python mca.py
    deps:
    - path: data/train/ben.npy
      hash: md5
      md5: 07dca973a84263d062907e19dc8031b7
      size: 1434489392
    - path: data/train/mal.npy
      hash: md5
      md5: 3b53f4382adf6b9b3122c284df107703
      size: 1434489392
    - path: dynamic.yaml
      hash: md5
      md5: 25cad90a2614a1e8ba9f069332625cad
      size: 47
    params:
      params.yaml:
        train.mca: data/MCA.csv
      dynamic.yaml:
        malgan.id: 984c6217d8cb4da6bd79ff089cca7355
    outs:
    - path: data/MCA.csv
      hash: md5
      md5: 7f675faffb4ed0bd8d61e61792fb8d29
      size: 76627
  split:
    cmd: python scripts/split.py
    deps:
    - path: data/raw/sleipnir/benign
      hash: md5
      md5: a94ca5d3a46622b553d9d35ef8f18f0a.dir
      size: 4037404256
      nfiles: 19696
    - path: data/raw/sleipnir/malicious
      hash: md5
      md5: c7057fcf38ebd7dc19f47bd8aef0a360.dir
      size: 7173280084
      nfiles: 34994
    params:
      params.yaml:
        split.benign_dir: data/raw/sleipnir/benign
        split.malware_dir: data/raw/sleipnir/malicious
        split.random_state: 42
        split.test_size: 0.2
        split.unique_ratio: 0.7
        train.head: 1500
        train.num_features: 200
    outs:
    - path: data/train/ben.npy
      hash: md5
      md5: ce4074b812b401fcff394adfb2688d9a
      size: 960128
    - path: data/train/mal.npy
      hash: md5
      md5: df2152dd414ad50c7634ec2d9938fe27
      size: 960128
    - path: data/valid/ben.npy
      hash: md5
      md5: f3eef3bb44f77921fa1ccf51d995b3c9
      size: 240128
    - path: data/valid/mal.npy
      hash: md5
      md5: e06ef45af5d48029c41019dee9b96437
      size: 240128
  train_malgan:
    cmd: python main.py 100 32 500 data/train/ben.npy --gen-hidden-sizes 256 512 512
      256 --activation leakyrelu data/train/mal.npy
    deps:
    - path: data/train/ben.npy
      hash: md5
      md5: ce4074b812b401fcff394adfb2688d9a
      size: 960128
    - path: data/train/mal.npy
      hash: md5
      md5: df2152dd414ad50c7634ec2d9938fe27
      size: 960128
    params:
      params.yaml:
        train.Z: 100
        train.activation: leakyrelu
        train.batch_size: 32
        train.benign: data/train/ben.npy
        train.estimators: 10
        train.gen_hidden: 256 512 512 256
        train.malware: data/train/mal.npy
        train.name: Layer_increase_higher_LR
        train.num_epochs: 500
      dynamic.yaml:
        detector.id: 9d792ffe830d4659aef41e75cca266d8
  train_mca:
    cmd: python mca.py
    deps:
    - path: data/train/ben.npy
      hash: md5
      md5: ce4074b812b401fcff394adfb2688d9a
      size: 960128
    - path: data/train/mal.npy
      hash: md5
      md5: df2152dd414ad50c7634ec2d9938fe27
      size: 960128
    params:
      params.yaml:
        train.estimators: 10
        train.head: 1500
        train.mca: data/MCA.csv
        train.mca_components: 30
    outs:
    - path: data/MCA.csv
      hash: md5
      md5: 3efa8cbd06823839487d7c463f0cb119
      size: 1496274
  train_mca_classifier:
    cmd: python mca_classifier.py
    deps:
    - path: data/MCA.csv
      hash: md5
      md5: 3efa8cbd06823839487d7c463f0cb119
      size: 1496274
    params:
      params.yaml:
        train.estimators: 10
        train.mca: data/MCA.csv
        train.mca_components: 30
  graph_mca:
    cmd: python scripts/graph_mca.py
    deps:
    - path: data/MCA.csv
      hash: md5
      md5: 3efa8cbd06823839487d7c463f0cb119
      size: 1496274
    outs:
    - path: outs/mca_scatter.html
      hash: md5
      md5: a93408e33cd1214e03336a1462a9b518
      size: 1931257
  extract_normal_features:
    cmd: python lime_normal.py
    deps:
    - path: data/MCA.csv
      hash: md5
      md5: 3efa8cbd06823839487d7c463f0cb119
      size: 1496274
    - path: data/train/ben.npy
      hash: md5
      md5: ce4074b812b401fcff394adfb2688d9a
      size: 960128
    - path: dynamic.yaml
      hash: md5
      md5: 305116a34ba7c53f6bd6e1655a661018
      size: 195
    params:
      params.yaml:
        train.benign: data/train/ben.npy
        train.mca: data/MCA.csv
        train.normal_features: data/normal_features.csv
      dynamic.yaml:
        mca.id: 8d4b1834747b42da9a5dd9c662a3e5d9
        mca_classifier.id: c66c11a6540b46e2bb203c17fbb34b6a
    outs:
    - path: data/normal_features.csv
      hash: md5
      md5: d426fbc8bf1b1cfe79450154111c05f7
      size: 6955
  experiment_base:
    cmd: PYTHONHASHSEED=0 python experiment.py normal
    deps:
    - path: data/valid/ben.npy
      hash: md5
      md5: f3eef3bb44f77921fa1ccf51d995b3c9
      size: 240128
    - path: data/valid/mal.npy
      hash: md5
      md5: e06ef45af5d48029c41019dee9b96437
      size: 240128
    - path: dynamic.yaml
      hash: md5
      md5: 305116a34ba7c53f6bd6e1655a661018
      size: 195
    params:
      params.yaml:
        metrics.normal: metrics/normal.json
        valid.benign: data/valid/ben.npy
        valid.malware: data/valid/mal.npy
      dynamic.yaml:
        detector.id: 9d792ffe830d4659aef41e75cca266d8
        malgan.id: 996ee3a8a9584ff48b423cff705fd50b
    outs:
    - path: metrics/normal.json
      hash: md5
      md5: dc17f9ec64581264fafc5197a28a236a
      size: 950
    - path: metrics/normal.png
      hash: md5
      md5: a2e03540eb4ccba188c8da4ce1c5c622
      size: 19015
  experiment_lime:
    cmd: PYTHONHASHSEED=0 python experiment.py lime
    deps:
    - path: data/MCA.csv
      hash: md5
      md5: 3efa8cbd06823839487d7c463f0cb119
      size: 1496274
    - path: data/normal_features.csv
      hash: md5
      md5: d426fbc8bf1b1cfe79450154111c05f7
      size: 6955
    - path: data/valid/ben.npy
      hash: md5
      md5: f3eef3bb44f77921fa1ccf51d995b3c9
      size: 240128
    - path: data/valid/mal.npy
      hash: md5
      md5: e06ef45af5d48029c41019dee9b96437
      size: 240128
    - path: dynamic.yaml
      hash: md5
      md5: 305116a34ba7c53f6bd6e1655a661018
      size: 195
    params:
      params.yaml:
        train.mca: data/MCA.csv
        train.normal_features: data/normal_features.csv
        valid.benign: data/valid/ben.npy
        valid.malware: data/valid/mal.npy
      dynamic.yaml:
        detector.id: 9d792ffe830d4659aef41e75cca266d8
        malgan.id: 996ee3a8a9584ff48b423cff705fd50b
        mca.id: 8d4b1834747b42da9a5dd9c662a3e5d9
        mca_classifier.id: c66c11a6540b46e2bb203c17fbb34b6a
    outs:
    - path: metrics/lime.json
      hash: md5
      md5: 84ae0b55856905bf29bc7de69f8dad39
      size: 933
    - path: metrics/lime.png
      hash: md5
      md5: ff4e71a5458f3033485f674d0cfbba21
      size: 21546
    - path: metrics/lime_obf.json
      hash: md5
      md5: 09b681f4d7ce331bfb3efbbd600cc9da
      size: 1077
    - path: metrics/lime_obf.png
      hash: md5
      md5: 7c6a785e80d95b047fc1ca72e1554dec
      size: 25771
  train_detector:
    cmd: python train_detector.py
    deps:
    - path: data/train/ben.npy
      hash: md5
      md5: ce4074b812b401fcff394adfb2688d9a
      size: 960128
    - path: data/train/mal.npy
      hash: md5
      md5: df2152dd414ad50c7634ec2d9938fe27
      size: 960128
    params:
      params.yaml:
        split.random_state: 42
        train.benign: data/train/ben.npy
        train.estimators: 10
        train.malware: data/train/mal.npy
  extract_normal_categorical_features:
    cmd: python lime_normal_categorical.py
    deps:
    - path: data/train/ben.npy
      hash: md5
      md5: ce4074b812b401fcff394adfb2688d9a
      size: 960128
    - path: dynamic.yaml
      hash: md5
      md5: 305116a34ba7c53f6bd6e1655a661018
      size: 195
    params:
      params.yaml:
        train.benign: data/train/ben.npy
        train.normal_categorical_features: data/normal_categorical_features.csv
      dynamic.yaml:
        detector.id: 9d792ffe830d4659aef41e75cca266d8
    outs:
    - path: data/normal_categorical_features.csv
      hash: md5
      md5: 5a3de3d81cb924e9df23ee45a05caa7c
      size: 19323
  experiment_lime_categorical:
    cmd: PYTHONHASHSEED=0 python experiment.py categorical
    deps:
    - path: data/normal_categorical_features.csv
      hash: md5
      md5: 5a3de3d81cb924e9df23ee45a05caa7c
      size: 19323
    - path: data/valid/ben.npy
      hash: md5
      md5: f3eef3bb44f77921fa1ccf51d995b3c9
      size: 240128
    - path: data/valid/mal.npy
      hash: md5
      md5: e06ef45af5d48029c41019dee9b96437
      size: 240128
    - path: dynamic.yaml
      hash: md5
      md5: 305116a34ba7c53f6bd6e1655a661018
      size: 195
    params:
      params.yaml:
        train.normal_categorical_features: data/normal_categorical_features.csv
        valid.benign: data/valid/ben.npy
        valid.malware: data/valid/mal.npy
      dynamic.yaml:
        detector.id: 9d792ffe830d4659aef41e75cca266d8
        malgan.id: 996ee3a8a9584ff48b423cff705fd50b
    outs:
    - path: metrics/lime_cat.json
      hash: md5
      md5: 4b7dcc2d90c5c3695c326659343331e3
      size: 920
    - path: metrics/lime_cat.png
      hash: md5
      md5: a69305a56750984e240cbb1f395a4bf9
      size: 18983
    - path: metrics/lime_cat_obf.json
      hash: md5
      md5: 42961eac853878a250340bc4c3714fe1
      size: 1086
    - path: metrics/lime_cat_obf.png
      hash: md5
      md5: b60044ed7cd8b93fc0b43fa4eb8ccd60
      size: 26335
  notify:
    cmd: python scripts/notify.py "Pipeline Layer_increase_higher_LR has been executed.
      More at https://flow.mlops"
    params:
      params.yaml:
        train.name: Layer_increase_higher_LR
